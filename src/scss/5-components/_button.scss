/* ============================================================
   5-COMPONENTS / _BUTTON.SCSS (Fixed Centering & Jitter)
   Batura Library | Unified Button v24.4 [Clean Center]
   ============================================================ */

.ui-button {
  text-decoration: none;
  color: inherit;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  
  /* 1. ГЕОМЕТРИЯ */
  --btn-h: var(--ui-h-btn-master); 
  --btn-radius: calc(var(--radius-master) * 0.4); 
  
  width: auto;
  min-width: 0; 
  padding-inline: var(--ui-p-btn); 

  /* Interaction Proxies */
  --_bg-op: var(--s-glass-op-base);
  --_stroke-op: var(--s-stroke-op-idle);
  --_text-op: var(--s-text-op-idle);

  @include glass-interactive(var(--btn-radius));
  
  /* ПОРЯДОК ВАЖЕН: сначала экстенд, потом переопределение */
  @extend .text-data;
  line-height: 1; // Сбрасываем line-height от .text-data

  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: var(--btn-h);
  
  /* ЦЕНТРИРОВАНИЕ И АНТИ-ДЕРГАНИЕ */
  padding-block: 0;
  backface-visibility: hidden; // Убирает микро-дрожание при переходах
  
  cursor: pointer;
  z-index: 10;
  color: rgba(var(--p-white-rgb), var(--_text-op));

  /* ВНУТРЕННИЙ ТЕКСТ */
  span {
    display: block;
    line-height: 1; // Гарантируем чистое межстрочное расстояние
    pointer-events: none;
  }

  /* Motion DNA */
  transition: 
    background-color var(--d-fast) var(--e-out),
    box-shadow var(--d-fast) var(--e-out),
    color var(--d-fast) var(--e-out),
    backdrop-filter var(--d-fast) var(--e-out),
    transform var(--d-fast) var(--e-out);
  
  transition-delay: var(--stagger-step);

  /* [ЛОГИКА ХОВЕРА] */
  .b-static-card:hover &, .b-card:hover & {
    transition-delay: 0s; 
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
    --_text-op: var(--s-text-op-hover);
  }

  &.ui-button:hover {
    transition-delay: 0s;
    --_bg-op: var(--s-glass-op-active);
    --_stroke-op: var(--s-stroke-op-active);
    --_text-op: 1;
  }

  &:active {
    transform: scale(var(--scale-press));
    transition-duration: 0.1s;
  }

  /* ============================================================
     3. ТЕГИ И ПЕРЕКЛЮЧАТЕЛИ ЛАБЫ
     ============================================================ */
  #tagsContainer &, .lab-mobile-switch & {
    --btn-h: var(--ui-h-btn-master);
    padding-inline: calc(var(--unit) * 6);
    transition-delay: 0s;
    
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);

    &:hover, &.is-active { 
      --_bg-op: var(--s-glass-op-active); 
      --_stroke-op: var(--s-stroke-op-active); 
      --_text-op: 1; 
      backdrop-filter: blur(var(--s-glass-blur-strong));
    }
  }

  &.ui-toggle-tag {
    --btn-h: var(--ui-h-btn-master);
    padding-inline: calc(var(--unit) * 6);
    transition-delay: 0s;
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
    width: 100%;

    &:hover, &.is-active { 
      --_bg-op: var(--s-glass-op-active); 
      --_stroke-op: var(--s-stroke-op-active); 
      --_text-op: 1; 
      backdrop-filter: blur(var(--s-glass-blur-strong));
      box-shadow: inset 0 0 0 var(--s-stroke-width) rgba(var(--m-glass-base-rgb), var(--s-stroke-op-active));
    }
  }

  /* 2. НАВБАР */
  .b-navbar & {
    --btn-h: var(--nav-content-h); 
    --btn-radius: var(--nav-inner-radius);
    padding-inline: var(--space-xs);
    
    &--logo, &--close {
      width: var(--btn-h);
      padding: 0;
      aspect-ratio: 1/1;
    }
  }

  /* 3. КНОПКА ЗАКРЫТИЯ */
  &--close:not(.b-navbar &) {
    width: var(--btn-h);
    padding: 0;
  }

  /* Вне контекста */
  &:not(.b-static-card &):not(.b-card &):not(.b-navbar &):not(#tagsContainer &):not(.lab-mobile-switch &) {
    --_bg-op: var(--s-glass-op-hover);
    --_stroke-op: var(--s-stroke-op-hover);
  }
}