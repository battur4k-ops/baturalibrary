/* ============================================================
   4-COMPONENTS / _B-PREVIEW-BOX.SCSS
   Batura Library | Preview Engine [Lab Sync Update]
   ============================================================ */

.b-preview-box {
  width: 100%;
  aspect-ratio: 16 / 9;
  position: relative;
  container-type: inline-size;
  
  border-radius: var(--local-preview-radius, var(--radius-inner));
  
  // Обводка карточки (box-shadow из миксина)
  @include glass-panel(inherit); 
  --_bg-op: var(--s-glare-op-hover);

  overflow: hidden; 
  transition: 
    background-color var(--d-fast) var(--e-out), 
    box-shadow var(--d-fast) var(--e-out),
    border-radius var(--d-base) var(--e-out);

  &::before {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(var(--theme-accent-rgb), var(--s-glare-op-hover)), transparent 75%);
    pointer-events: none;
    z-index: 1;
  }

  @include glass-dots;
  
  --lab-preview-viewport-scale: 1;
  --lab-preview-layer-size: clamp(64px, 20cqw, 128px);
  --lab-preview-step: var(--lab-preview-layer-size);
  --lab-preview-motion: clamp(18px, 7cqw, 44px);

  }


.b-preview-box .lab-preview-stack {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 2;
  pointer-events: none;
  transform: translate3d(0, 0, 0) scale(var(--lab-preview-viewport-scale, 1));
  transform-origin: center;
}

.b-preview-box .lab-preview-layer {
  width: var(--lab-preview-layer-size);
  height: var(--lab-preview-layer-size);
  border-radius: var(--lab-preview-layer-radius);
  @include glass-panel(var(--lab-preview-layer-radius));
  position: absolute;
  --_bg-op: var(--s-glass-op-hover);
  --_stroke-op: var(--s-stroke-op-active);
  --_glare-op: 0;
  --_blur: var(--s-glass-blur-none);
  backdrop-filter: none;
  -webkit-backdrop-filter: none;
  box-shadow: inset 0 0 0 var(--preview-stroke-width, var(--s-stroke-width)) rgba(var(--m-glass-base-rgb), var(--_stroke-op, var(--s-stroke-op-idle)));
  opacity: calc(1 - (var(--layer-index) * 0.12));
  transform: translate3d(0, 0, 0);
  transform-origin: center;
  backface-visibility: hidden;
  transition: opacity var(--d-fast) var(--e-out);
  will-change: transform;
}

.b-preview-box .lab-preview-layer::before {
  opacity: 0;
}

.b-preview-box .lab-preview-text {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  font-family: var(--font-mono);
  font-size: clamp(12px, 3cqw, 20px);
  letter-spacing: var(--ls-data);
  color: rgba(var(--p-white-rgb), 0.9);
  text-align: center;
  z-index: 2;
  pointer-events: none;
  text-transform: none;
}